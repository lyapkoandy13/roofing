{% extends 'admin_panel/layout.html' %}

{% block content %}
	{% load static %}
	<div class="container">
		
		{% if state == "edit" %}
		    <h2>Товар {{ some_id }}</h2>
		    <hr style="border-color: white;">
		    <form method="post" action="/admin/edit_good/" enctype="multipart/form-data" id="good_form">
		{% else %}
	        <form method="post" action="/admin/add_good/" enctype="multipart/form-data" id="good_form">
		{% endif%}

			{% csrf_token %}
			
				<input type="hidden" name="csrfmiddlewaretoken" value="bLhgdqMmnVfhzMtqAjHshArBwP655FfBnaZZ4tofdnr8iQs4qCMLanJaCHQTOTw4">
				<p><label for="id_name">Назва</label> <input id="id_name" maxlength="255" name="name" type="text" required="" class="form-control"></p>
				<p><label for="id_description">Опис</label> <textarea cols="40" id="id_description" name="description" rows="10" required="" class="form-control"></textarea></p>
				<p><label for="id_price">Ціна</label> <input id="id_price" name="price" step="0.01" type="number" required="" class="form-control"></p>
				<p><label for="id_images">Додати зображення</label> <input multiple="multiple" type="file" id="id_images" name="images" required="" class="form-control"></p>
	        
	        {% if state == "edit" %}
	        	<p>Старі зображення: </p>
		        <!--
		        <img style="margin-bottom: 20px" src="" id="old_image">
		        <br>
		        <input id="some_id" type="hidden" name="some_id" />
	        	-->
	        	
	        	<div id="carouselImages" class="carousel slide" data-ride="carousel">
				  <div class="carousel-inner" role="listbox">
				    
				    {% for image in images %}
						<div class="carousel-item">
					      <img class="d-block img-fluid" src="{{ image.image }}" alt="slide">
					    </div>
					{% endfor %}
				    
				  </div>
				  <a class="carousel-control-prev" href="#carouselImages" role="button" data-slide="prev">
				    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
				    <span class="sr-only">Previous</span>
				  </a>
				  <a class="carousel-control-next" href="#carouselImages" role="button" data-slide="next">
				    <span class="carousel-control-next-icon" aria-hidden="true"></span>
				    <span class="sr-only">Next</span>
				  </a>
				</div>

	        {% endif %}
	        <button class="btn btn-primary" class="form-control" type="submit" id="submit_good ">Зберегти</button>
		</form>

	</div>

	<script type="text/javascript">
		$( document ).ready(function(){

			if("{{ state }}"=="edit"){
				// alert('edit');
				$("#some_id").val("{{ some_id }}");
				$("#id_name").val("{{ name }}");
				$("#id_description").val(`{{ description }}`);
				$("#id_price").val("{{ price }}");
				$("#old_image").attr("src", "/media/{{ image }}");
			}

			$("#id_name").addClass("form-control");
			$("#id_description").addClass("form-control");
			$("#id_price").addClass("form-control");
			$("#id_image").addClass("form-control");
		});

			// $('#good_form').on('submit', function(event){
			//     event.preventDefault();
			//     if("{{ state }}"!=="edit"){
			// 	    $.ajax({
			// 	        url : "/admin/ajax/add_good/", // the endpoint
			// 	        type : "POST", // http method
			// 	        data : {
			// 	        	name : $('#id_name').val(),
			// 	        	description : $('#id_description').val(),
			// 	        	price : $('#id_price').val(),
			// 	        	image : $('#id_image').val(),
			// 	        	csrfmiddlewaretoken : "{{ csrf_token }}",
			// 	        }, // data sent with the post request

			// 	        // handle a successful response
			// 	        success : function(json) {
			// 	        	window.location.href = '/admin/';
			// 	        	// alert(json);
			// 	        }
			// 	    });
			// 	} else {
			// 		$.ajax({
			// 	        url : "/admin/ajax/edit_good/", // the endpoint
			// 	        type : "POST", // http method
			// 	        data : {
			// 	        	name : $('#id_name').val(),
			// 	        	description : $('#id_description').val(),
			// 	        	price : $('#id_price').val(),
			// 	        	image : $('#id_image').val(),
			// 	        	csrfmiddlewaretoken : "{{ csrf_token }}",
			// 	        	id : "{{ id }}"
			// 	        }, // data sent with the post request

			// 	        // handle a successful response
			// 	        success : function(json) {
			// 	        	window.location.href = '/admin/';
			// 	        	// alert(json);
			// 	        }
			// 		});
			// 	}
			// });
		// });

	</script>
	
{% endblock %}